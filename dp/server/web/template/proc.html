<%!
    from dp.server.main import isRun
%>
<%inherit file="procBase.html"/>
<h2>Process List</h2>
% if msg:
	<div class="alert alert-info">
		<button type="button" class="close" data-dismiss="alert">Ã—</button>
		${msg}
	</div>
% endif
<table class="table table-striped table-bordered table-condensed">
	<thead>
		<tr>
			<th>Group</th>
			<th>Name</th>
			<th>Status</th>
			<th>Last Updated</th>
			<th>Last Patched</th>
			% if isRun(currentIp):
			<th>Operations</th>
			% endif
		<tr>
	</thead>
	<tbody>
		% for key,value in procDict.iteritems():
			% for i,procRow in enumerate(value):
		<tr>
			% if i==0 :
				<td rowspan="${len(value)}">${key}</td>
			% endif
			<td><a href="/clientProcInfo?name=${procRow[3]}">${procRow[0]}</a></td>
			<td>
			% if isRun(procRow[3]):
				<span class="label label-success">
			% else:
				<span class="label label-important">
			% endif
				${procRow[1].name}
				</span>
			</td>
			<td>${procRow[2]}</td>
			<td>N/A</td>
			% if isRun(currentIp):
			<td style="width:230px;">
				<form class="form-inline" style="margin-bottom:2px;" method="POST" action="/procOp">
				<input type="hidden" name="name" value="${procRow[3]}"></input>
				<input class="btn" type="submit" name="op" value="Restart"></input>
				<input class="btn" type="submit" name="op" value="Patch"></input>
				<a class="btn" data-toggle="modal" href="/procOp?name=${procRow[3]}">Console</a>
				</form>
			</td>
			% endif
		</tr>
			% endfor
		% endfor
	</tbody>
</table>
<%block name="footScripts">
  <script type="text/javascript">$(function () {
	$('[data-toggle="modal"]').click(function(e) {
		e.preventDefault();
		var href = $(this).attr('href');
		$.get(href, function(data) {
			$('<div class="modal fade" >' + data + '</div>').modal();
		});
	});  
  });</script>
</%block>
